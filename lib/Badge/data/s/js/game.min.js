var NUM_MONSTERS1=30,NUM_MONSTERS2=20,maxX=468,maxY=425,movetime=1e3,speed=10,end=!1,dead=0,reloading=!1,monstersDir=1,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=512,canvas.height=480,$(document).ready(function(){$("#startButton").click(function(){$(this).hide(),document.body.appendChild(canvas)})});var heroReady=!(bgReady=!0),heroImage=new Image;heroImage.onload=function(){heroReady=!0};var a1Ready=!(heroImage.src="images/hero.png"),a1Image=new Image;a1Image.onload=function(){a1Ready=!0};var a2Ready=!(a1Image.src="images/a1.png"),a2Image=new Image;a2Image.onload=function(){a2Ready=!0};var a3Ready=!(a2Image.src="images/a2.png"),a3Image=new Image;a3Image.onload=function(){a3Ready=!0};var a4Ready=!(a3Image.src="images/a3.png"),a4Image=new Image;a4Image.onload=function(){a4Ready=!0};var shotReady=!(a4Image.src="images/a4.png"),shotImage=new Image;shotImage.onload=function(){shotReady=!0};var heroshotReady=!(shotImage.src="images/enemyshot.png"),heroshotImage=new Image;heroshotImage.onload=function(){heroshotReady=!0};var monsterDestroyedReady=!(heroshotImage.src="images/heroshot.png"),monsterDestroyedImage=new Image;monsterDestroyedImage.onload=function(){monsterDestroyedReady=!0};var congratulationsReady=!(monsterDestroyedImage.src="images/dying.png"),congratulationsImage=new Image;congratulationsImage.onload=function(){congratulationsReady=!0};var gameoverReady=!(congratulationsImage.src="images/gratz.png"),gameoverImage=new Image;gameoverImage.onload=function(){gameoverReady=!0},gameoverImage.src="images/gameover.png";var hero={speed:1,x:canvas.width/2,y:canvas.height-50,shootX:0,shootY:0,isShooting:!1},monsters=new Array,tmp={speed:3,x:32,y:32,shootX:500,shootY:500,shootDir:1,last:!1,isShooting:!0,image:2<=Math.ceil(4*Math.random()),isAlive:!0,scoreValue:20,destroyed:0};monsters.push(tmp);for(var i=1;i<NUM_MONSTERS1;i++){var obj={speed:3,x:monsters[i-1].last?32:monsters[i-1].x+32,y:monsters[i-1].last?monsters[i-1].y+32:monsters[i-1].y,shootX:500,shootY:500,shootDir:1,last:(i+1)%10==0,isShooting:!0,image:2<=Math.floor(4*Math.random()),isAlive:!0,scoreValue:20,destroyed:0};monsters.push(obj)}var monsters2=new Array,tmp2={speed:3,x:32,y:32*(NUM_MONSTERS1/10+1),shootX:500,shootY:500,shootDir:1,last:!1,isShooting:!0,image:2<=Math.ceil(4*Math.random()),isAlive:!0,scoreValue:10,destroyed:0};monsters2.push(tmp2);for(i=1;i<NUM_MONSTERS2;i++){obj={speed:3,x:monsters2[i-1].last?32:monsters2[i-1].x+32,y:monsters2[i-1].last?monsters2[i-1].y+32:monsters2[i-1].y,shootX:500,shootY:500,shootDir:1,last:(i+1)%10==0,isShooting:!0,image:2<=Math.floor(4*Math.random()),isAlive:!0,scoreValue:10,destroyed:0};monsters2.push(obj)}var score=0,shots=0,keysDown={};addEventListener("keydown",function(e){keysDown[e.keyCode]=!0},!1),addEventListener("keyup",function(e){delete keysDown[e.keyCode]},!1);var reset=function(){hero.shootX=hero.x+12,hero.shootY=hero.y},count=0,path=0,changed=!1,update=function(e){37 in keysDown&&(hero.x-=+hero.speed,hero.x=Math.max(hero.x,15)),39 in keysDown&&(hero.x+=+hero.speed,hero.x=Math.min(hero.x,468)),32 in keysDown&&(hero.isShooting||(hero.isShooting=!0,hero.shootX=hero.x+12,hero.shootY=hero.y));var o=speed;if(count<movetime?o=0:(count=0,path++),10<=path){monstersDir*=-1;for(var s=path=0;s<NUM_MONSTERS1;s++)monsters[s].y+=10;for(s=0;s<NUM_MONSTERS2;s++)monsters2[s].y+=10;changed=!0}for(s=0;s<NUM_MONSTERS1;s++)monsters[s].isAlive&&(s*s*s*Math.ceil(100*Math.random())==count&&(monsters[s].isShooting=!0),monsters[s].isShooting&&(monsters[s].shootY+=monsters[s].shootDir),count||(monsters[s].image=!monsters[s].image),700<monsters[s].shootY&&(monsters[s].isShooting=!1,monsters[s].shootX=monsters[s].x,monsters[s].shootY=monsters[s].y+5),changed||(monsters[s].x+=o*monstersDir),monsters[s].y>maxY-40&&gameover(0));for(s=0;s<NUM_MONSTERS2;s++)monsters2[s].isAlive&&(s*s*s*Math.ceil(100*Math.random())==count&&(monsters2[s].isShooting=!0),monsters2[s].isShooting&&(monsters2[s].shootY+=monsters2[s].shootDir),count||(monsters2[s].image=!monsters2[s].image),700<monsters2[s].shootY&&(monsters2[s].isShooting=!1,monsters2[s].shootX=monsters2[s].x,monsters2[s].shootY=monsters2[s].y+5),changed||(monsters2[s].x+=o*monstersDir),monsters2[s].y>maxY-40&&gameover(0));count++,changed=!1,hero.isShooting&&(hero.shootY-=3,hero.shootY<0&&(hero.isShooting=!1));for(s=0;s<NUM_MONSTERS1;s++)monsters[s].isShooting&&monsters[s].isAlive&&Math.abs(hero.x-monsters[s].shootX)<=20&&Math.abs(hero.y-monsters[s].shootY)<=20&&monsters[s].shootY>hero.y&&gameover(0);for(s=0;s<NUM_MONSTERS1;s++)monsters[s].isAlive?hero.shootX<=monsters[s].x+20&&monsters[s].x<=hero.shootX+20&&hero.shootY<=monsters[s].y+20&&monsters[s].y<=hero.shootY+20&&(hero.isShooting&&(score+=monsters[s].scoreValue),reset(),hero.isShooting=!1,monsters[s].isShooting=!1,monsters[s].isAlive=!1,movetime-=20):dead++;for(s=0;s<NUM_MONSTERS2;s++)monsters2[s].isShooting&&monsters2[s].isAlive&&Math.abs(hero.x-monsters2[s].shootX)<=20&&Math.abs(hero.y-monsters2[s].shootY)<=20&&monsters2[s].shootY>hero.y&&gameover(0);for(s=0;s<NUM_MONSTERS2;s++)monsters2[s].isAlive?hero.shootX<=monsters2[s].x+20&&monsters2[s].x<=hero.shootX+20&&hero.shootY<=monsters2[s].y+20&&monsters2[s].y<=hero.shootY+20&&(hero.isShooting&&(score+=monsters2[s].scoreValue),reset(),hero.isShooting=!1,monsters2[s].isShooting=!1,monsters2[s].isAlive=!1,movetime-=20):dead++;dead==NUM_MONSTERS1+NUM_MONSTERS2?gameover(1):dead=0},count=0,render=function(){bgReady&&(ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height)),heroReady&&(ctx.drawImage(heroImage,hero.x,hero.y),hero.isShooting&&heroshotReady&&ctx.drawImage(heroshotImage,hero.shootX,hero.shootY));for(var e=0;e<NUM_MONSTERS1;e++){a1Ready&&(o=!1,monsters[e].isAlive?(ctx.drawImage(monsters[e].image?a1Image:a2Image,monsters[e].x,monsters[e].y),monsters[e].isShooting&&ctx.drawImage(shotImage,monsters[e].shootX,monsters[e].shootY)):monsters[e].destroyed<=10&&(ctx.drawImage(monsterDestroyedImage,monsters[e].x,monsters[e].y),o=!0),o&&monsters[e].destroyed++)}for(var o,e=0;e<NUM_MONSTERS2;e++){a3Ready&&(o=!1,monsters2[e].isAlive?(ctx.drawImage(monsters2[e].image?a3Image:a4Image,monsters2[e].x,monsters2[e].y),monsters2[e].isShooting&&ctx.drawImage(shotImage,monsters2[e].shootX,monsters2[e].shootY)):monsters2[e].destroyed<=10&&(ctx.drawImage(monsterDestroyedImage,monsters2[e].x,monsters2[e].y),o=!0),o&&monsters2[e].destroyed++)}ctx.fillStyle="rgb(250,250,250)",ctx.font="24px Helvetica",ctx.textAlign="left",ctx.textBaseline="bottom",ctx.fillText("Score: "+score,32,32),count++},renderGameOver=function(){ctx.drawImage(gameoverImage,0,0),ctx.drawImage(monsterDestroyedImage,hero.x,hero.y),32 in keysDown&&!reloading&&(reloading=!0,location.reload())},renderGameComplete=function(){ctx.drawImage(congratulationsImage,0,0)},gameover=function(e){clearInterval(program),0==e?setInterval(renderGameOver,1):setInterval(renderGameComplete,1)},main=function(){var e=Date.now();end||(update((e-then)/1e3),render()),then=e},then=Date.now(),program=setInterval(main,5);